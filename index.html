<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bandit-Based Experiments and Policy Evaluation • banditsCI</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Bandit-Based Experiments and Policy Evaluation">
<meta name="description" content="Provides functions for conducting frequentist inference on adaptively generated data. The methods implemented are based on Zhan et al. (2021) &lt;doi:10.48550/arXiv:2106.02029&gt; and Hadad et al. (2021) &lt;doi:10.48550/arXiv:1911.02768&gt;. For illustration, several functions for simulating non-contextual and contextual adaptive experiments using Thompson sampling are also supplied.">
<meta property="og:description" content="Provides functions for conducting frequentist inference on adaptively generated data. The methods implemented are based on Zhan et al. (2021) &lt;doi:10.48550/arXiv:2106.02029&gt; and Hadad et al. (2021) &lt;doi:10.48550/arXiv:1911.02768&gt;. For illustration, several functions for simulating non-contextual and contextual adaptive experiments using Thompson sampling are also supplied.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">banditsCI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/banditsCI.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UChicago-pol-methods/banditsCI/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="confidence-intervals-with-adaptively-generated-data">Confidence intervals with adaptively generated data<a class="anchor" aria-label="anchor" href="#confidence-intervals-with-adaptively-generated-data"></a>
</h1></div>
<p>This package provides functions for conducting frequentist inference on adaptively generated data. These functions produce point estimates and confidence intervals, using the methods proposed in <a href="https://arxiv.org/abs/2106.02029" class="external-link">Zhan, Ruohan, et al. (2021)</a> and <a href="https://arxiv.org/abs/1911.02768" class="external-link">Hadad, Vitor, et al. (2021)</a>. The code in this package is directly adapted from the original python code for those publications, documented at - <a href="https://github.com/gsbDBI/adaptive-confidence-intervals" class="external-link">github.com/gsbDBI/adaptive-confidence-intervals</a> and - <a href="https://github.com/gsbDBI/contextual_bandits_evaluation" class="external-link">github.com/gsbDBI/contextual_bandits_evaluation</a>.</p>
<p>For illustration, several functions for simulating non-contextual and contextual adaptive experiments using Thompson sampling are also supplied.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>The latest release of the package can be installed through CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"banditsCI"</span><span class="op">)</span></span></code></pre></div>
<p>The current development version can be installed from source using devtools:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Uchicago-pol-methods/banditsCI"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="usage-examples">Usage Examples<a class="anchor" aria-label="anchor" href="#usage-examples"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/UChicago-pol-methods/banditsCI" class="external-link">banditsCI</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">60637</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate synthetic data. </span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/generate_bandit_data.html">generate_bandit_data</a></span><span class="op">(</span>xs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run a simulated (non-contextual) experiment. </span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_experiment.html">run_experiment</a></span><span class="op">(</span>ys <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">ys</span>,</span>
<span>                          floor_start <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">K</span>,</span>
<span>                          floor_decay <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>                          batch_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate mean response under treatment arms. </span></span>
<span><span class="co">## Balancing weights</span></span>
<span><span class="va">balwts</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculate_balwts.html">calculate_balwts</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">ws</span>, <span class="va">results</span><span class="op">$</span><span class="va">probs</span><span class="op">)</span></span>
<span><span class="co">## ipw scores</span></span>
<span><span class="va">aipw_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/aw_scores.html">aw_scores</a></span><span class="op">(</span></span>
<span>  ws <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">ws</span>, </span>
<span>  yobs <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">yobs</span>, </span>
<span>  K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">ys</span><span class="op">)</span>,</span>
<span>  balwts <span class="op">=</span> <span class="va">balwts</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The policies we're evaluating</span></span>
<span><span class="va">policy1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">K</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pol_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">A</span>, ncol <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">K</span><span class="op">)</span></span>
<span>  <span class="va">pol_mat</span><span class="op">[</span>,<span class="va">x</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">pol_mat</span></span>
<span><span class="op">}</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Estimation</span></span>
<span><span class="va">out_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/output_estimates.html">output_estimates</a></span><span class="op">(</span></span>
<span>  policy1 <span class="op">=</span> <span class="va">policy1</span>, </span>
<span>  gammahat <span class="op">=</span> <span class="va">aipw_scores</span>, </span>
<span>  probs_array <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">probs</span>,</span>
<span>  floor_decay <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_full</span></span></code></pre></div>
<p>For a more detailed description of how to use the package functions, see the <a href="https://uchicago-pol-methods.github.io/banditsCI/articles/banditsCI.html">vignette</a>.</p>
</div>
<div class="section level3">
<h3 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h3>
<p>We produce estimates under different adaptive weighting schemes in the <code><a href="reference/output_estimates.html">output_estimates()</a></code> function. Weighting schemes include:</p>
<ul>
<li>(Augmented) Inverse Probability Weighted estimates, with uniform weights,
<ul>
<li>Estimated with argument <code>uniform = TRUE</code>.</li>
</ul>
</li>
<li>Non-contextual variance minimizing estimates,
<ul>
<li>Estimated with argument <code>non_contextual_minvar = TRUE</code>.</li>
<li>Source: <a href="https://arxiv.org/abs/2106.02029" class="external-link">Zhan et al. (2021)</a> Equation (6) with <code>MinVar</code> function <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msqrt><mrow><mn>1</mn><mi>/</mi><mi>v</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">\phi(v) = \sqrt{1/v}</annotation></semantics></math>
</li>
</ul>
</li>
<li>Contextual variance minimizing estimates,
<ul>
<li>Estimated with argument <code>contextual_minvar = TRUE</code>.</li>
<li>Source: <a href="https://arxiv.org/abs/2106.02029" class="external-link">Zhan et al. (2021)</a> Equation (11) with <code>MinVar</code> function <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msqrt><mrow><mn>1</mn><mi>/</mi><mi>v</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">\phi(v) = \sqrt{1/v}</annotation></semantics></math>
</li>
</ul>
</li>
<li>Non-contextual variance stabilizing estimates,
<ul>
<li>Estimated with argument <code>non_contextual_stablevar  = TRUE</code>.</li>
<li>Source: <a href="https://arxiv.org/abs/2106.02029" class="external-link">Zhan et al. (2021)</a> Equation (6) with <code>StableVar</code> function <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mi>/</mi><mi>v</mi></mrow><annotation encoding="application/x-tex">\phi(v) = 1/v</annotation></semantics></math>
</li>
</ul>
</li>
<li>Contextual variance stabilizing estimates,
<ul>
<li>Estimated with argument <code>contextual_stablevar = TRUE</code>.</li>
<li>Source: <a href="https://arxiv.org/abs/2106.02029" class="external-link">Zhan et al. (2021)</a> Equation (11) with <code>StableVar</code> function <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mi>/</mi><mi>v</mi></mrow><annotation encoding="application/x-tex">\phi(v) = 1/v</annotation></semantics></math>
</li>
</ul>
</li>
<li>Non-contextual two-point estimates using a “stick-breaking” procedure
<ul>
<li>Estimated with argument <code>non_contextual_twopoint = TRUE</code>.</li>
<li>Source: <a href="https://arxiv.org/abs/1911.02768" class="external-link">Hadad, Vitor, et al. (2021)</a> Equation (18)</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="replication">Replication<a class="anchor" aria-label="anchor" href="#replication"></a>
</h3>
<p>We illustrate precise replication of simulated experimental results using the code from the original papers (we modify python notebooks for the benefit of illustration). The code for the replication is available in the following repositories:</p>
<ul>
<li>
<strong>Non-contextual replication</strong>: <a href="https://github.com/UChicago-pol-methods/adaptive-confidence-intervals" class="external-link">Replication with python experiment Data</a>
</li>
<li>
<strong>Contextual replication</strong>: <a href="https://github.com/Uchicago-pol-methods/contextual_bandits_evaluation" class="external-link">Replication with python experiment Data</a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<ul>
<li>Zhan, Ruohan, Vitor Hadad, David A. Hirshberg, and Susan Athey. “Off-policy evaluation via adaptive weighting with data from contextual bandits.” In <em>Proceedings of the 27th ACM SIGKDD Conference on Knowledge Discovery &amp; Data Mining</em>, pp. 2125-2135. 2021. <a href="https://arxiv.org/abs/2106.02029" class="external-link">https://arxiv.org/abs/2106.02029</a>
</li>
<li>Hadad, Vitor, David A. Hirshberg, Ruohan Zhan, Stefan Wager, and Susan Athey. “Confidence intervals for policy evaluation in adaptive experiments.” <em>Proceedings of the national academy of sciences</em> 118, no. 15 (2021): e2014602118. <a href="https://arxiv.org/abs/1911.02768" class="external-link">https://arxiv.org/abs/1911.02768</a>
</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/UChicago-pol-methods/banditsCI/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/UChicago-pol-methods/banditsCI/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3) + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing banditsCI</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Molly Offer-Westort <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0003-2787-9919" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Yinghui Zhou <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0002-3515-9751" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Zhan Ruohan <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-3426-2784" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Molly Offer-Westort, Yinghui Zhou, Zhan Ruohan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
